---
layout: single
title:  "The Brushless Controller ESC"
permalink: /projects/fpv/esc
excerpt: "An Electronic Speed Controller (ESC) controls a brushless dc motor with input from the Flight Controller."
date:   2019-11-18 09:00:35 +0100
categories: [fpv, quad]
tags: [fpv, quad, race, drone, esc, electronic, speed, controller]
comments: true
use_math: true
toc: true
classes: wide
# toc_label: "Unscented Kalman Filter"
header:
  teaser: /assets/collections/fpv/esc/dys-aria-esc.jpg
  overlay_image: /assets/collections/fpv/esc/dys-aria-esc.jpg
  overlay_filter: 0.5
redirect_from:
  - /projects/fpv/
sidebar:
  nav: "fpv"
---

Compared to a conventional brushed dc motor, which is controlled via its applied voltage, the control of 
a brushless dc motor with its three phase wires requires a dedicated controller. Such a controller is known as
electronic speed controller (ESC). The responsibility of this part is to control the flow of current direction through its
individual output phases that are connected to a brushless dc.

<figure >
    <a href="/assets/collections/fpv/esc/dys-aria-escs.jpg"><img src="/assets/collections/fpv/esc/dys-aria-escs.jpg"></a>
    <figcaption>DYS Aria ESC.</figcaption>
</figure>

## ESC Function

Given a desired input signal from the transmitter, an ESC takes over the coordination to correctly control flow of current through the three phase wires of a brushless motor of which the currently set motor position needs to be aquired. 
This can be achieved through two ways: one is to use [Hall effect sensors](https://en.wikipedia.org/wiki/Hall_effect_sensor) or to make use of the so called counter-electromotive force (also known as [back EMF](https://en.wikipedia.org/w/index.php?title=Back_EMF)). A spinning motor also acts as a generator that generates a force which can be measured by the ESC.
With this measurement the position of the rotor can be infered. 

A Hall effect sensor can make use of the magnetic interaction of the magnets on the rotor to provide a signal
that evaluates to the position of the rotor. A [receiver](/projects/fpv/glossar/#receiver) or [flight controller (FC)](/projects/fpv/glossar/#fc) commands the the speed of a motor and compares the desired with the target 
speed value. With this speed difference it is possible to adjust the speed to reduce the difference. 

An ESC controls the speed of a motor via [pulse witdth modulation (PWM)](https://en.wikipedia.org/wiki/Pulse-width_modulation). 
The ESC controls the power supplied from the battery to the motor taking into account the commands of a flight controller or a receiver. For example, an ESC can be targeted to provide 50% of the maxium possible power to its connected motor.
PWM controls the rate at which power is fed from the power source (battery) to the load (motor). 
For example, given that the PWM rate for 100% motor power is 50 kHz, an ESC which should operate the motor at 50% power
will provide the full battery power at a 25 kHz rate.


## P-FET or N-FET

The feed-through of energy is realised through transistors. 
An ESC with a "FET" imprint, shows it consists of [field-effect transistor](https://en.wikipedia.org/wiki/Field-effect_transistor). Field-effect transitors consist of a [metal–oxide–semiconductor](https://en.wikipedia.org/wiki/MOSFET)
which are known as MOSFETs. They are seperated in [n-type](https://en.wikipedia.org/wiki/NMOS_logic) and [p-type](https://en.wikipedia.org/wiki/PMOS_logic). The n stands for negative (transistor electron conduction) and the p stands for positive (transistor electron hole conduction). N-type FETs are much more efficient because of their construction design, 
which is due to their lower inner resistance. This means, that an n-type FET wastes less energy through thermal loss.

P-type Fets heat up much more because of their internal resistor and need to be cooled better.
This is why they are mounted in the air flow of the rotor. An ESC which is equipped exclusively with n-type FETs
operates more efficient. This leads to an increased flight time at the cost of a higher price for the component. 
Therefore, low-priced and small ESCs, found in smaller drones, contain a mix of p-type and n-type FETs. 

<figure >
    <a href="/assets/collections/fpv/esc/dys-aria-esc.jpg"><img src="/assets/collections/fpv/esc/dys-aria-esc.jpg"></a>
    <figcaption>DYS Aria ESC.</figcaption>
</figure>

Brushless controllers are common in many RC-models, especially where brushless dc motors are used.
As mentioned, multi copters are controlled via the rotational speed of the motors, 
which is why they require a special type of controller. 
For a stable flight behavior it is important to use a suitable ESC that is capable of quickly processing and applying the information which rotor speed should be set to a motor. Processing and applying this signal faster leads
to a more percise and faster control of the race drone. The processing-speed of the controller is especially important
for acrobatic or race flights.

## ESC Software

A drone will crash if the information of a flight pose correction gets passed to a controller that is not capable of 
applying the updated rotational speed fast enough. This is why, a special kind of ESCs was developed for use in
multi copters - to be more percise: special software that runs on the ESCs. Common brushless controllers have
a latency (speed of reaction) of 20 ms, which is equivalent to a rate of 50 Hz. 
This suffice for the conventional RC-models but it isn't for multicopters. 
The datasheet of an ESC for a multi copter should list 400 Hz. 

There are at least two options to choose suitable ESCs. On the one hand, manufacturers of multicopter motors offer suitable ESCs for their motors. These ESCs match to the use with the motors of the manufacturer. On the other hand, it is possible to buy brushless controllers with a dedicated multicopter software or to [flash](/projects/fpv/glossar#flash) suitable controllers with this software.

**Flashing** means to update the software, also refered to as firmware, that runs on a device, such as an ESC. ESCs which are not intended to be used with multicopters can be made usable by flashing a dedicated firmware.
{: .note }

### SimonK

One of the most used software, that was specifically developed to be used in multicopters, is the SimonK software, by Simon Kirby.

The software was developed to realise quick changes of motor velocity and is freely available in [SimonK's GitHub repository](https://github.com/sim-/tgy). A lot of multicopter brushless ESCs come pre installed with this software. 
A list of compatible ESCs can be found in [this Google spread sheet](https://docs.google.com/spreadsheets/d/13tMlu5ldLNpZXwbe6UhDHJhcgTVuljm8HDiDp9WO9Pk/edit#gid=0).
One characteristic feature is that the control signals of the [flight controller](/projects/fpv/glossar#flight-controller) are processed with clock frequencies above 400 Hz, which is fast enough to control a multicopter. 
Unlike a regural ESC, the acutation of the motor doesn't happen with 8,000 Hz but rates up to 18,000 Hz. 
This means that the ESC is controlling the motor 18,000 times pre second, which enables fast pose corrections and agressive flight maneuvers.

### BLHeli

BLHeli is another commonly used firmware for multicopters. Originally developed for helicopters, 
today it is optimized and usable for multicopters as well. In most cases this software provides the OneShot additon.
This is a new ESC protocol to replace [PWM](/projects/fpv/glossar#pwm) which allows to increase the communication frequency between [flight controller](/projects/fpv/glossar#flight-controller) and ESC. This way the drone is able to 
realise new pose adjustemns or control inputs quickly. Because of the optimisation technique that OneShot provides,
ESCs that run BLHeli firmware are commonly used for FPV race quads.

### OneShot125 Protocol





## Further reading material

[ESC Article on Wikipedia](https://en.wikipedia.org/wiki/Electronic_speed_control)

A flashing tutorial can be found in the [RCgroups forum](https://www.rcgroups.com/forums/showthread.php?1513678-RCTimer-Turnigy-Hobbywing-ESC-DIY-Firmware-Flashing) and to install generic usb drivers on windows you can use [Zadig](https://zadig.akeo.ie/).
